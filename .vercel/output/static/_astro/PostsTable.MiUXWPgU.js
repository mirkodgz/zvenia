import{j as e}from"./jsx-runtime.BBGWwODT.js";import{r}from"./index.DYwCuWnG.js";import{f as u,u as N,a as p,g as v,b as w,c as S,d as C}from"./format.-X2iPvTI.js";import{c as M}from"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";function E(){const[o,d]=r.useState([]),[h,c]=r.useState(!0),[g,x]=r.useState(""),[y,f]=r.useState([]),m=M("https://ddgdtdhgaqeqnoigmfrh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZ2R0ZGhnYXFlcW5vaWdtZnJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwNDE3NjMsImV4cCI6MjA4MjYxNzc2M30.aSW3Ds1z-8ta1sx-22P3NGyx4jzaY0aGNPPB9PsFcs0");r.useEffect(()=>{b()},[]);const b=async()=>{c(!0);const{data:t,error:a}=await m.from("posts").select("*, author:profiles(full_name, avatar_url)").order("created_at",{ascending:!1}).limit(1e3);a?(console.error("Error fetching posts:",a),alert("Error fetching posts")):d(t||[]),c(!1)},j=async t=>{if(!confirm("Are you sure you want to delete this post?"))return;const{error:a}=await m.from("posts").delete().eq("id",t);a?(console.error("Error deleting post:",a),alert("Error deleting post")):d(o.filter(n=>n.id!==t))},i=r.useMemo(()=>[{accessorKey:"title",header:"Title",cell:({row:t})=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.original.title}),t.original.excerpt&&e.jsx("div",{className:"text-xs text-gray-600 truncate mt-1",children:t.original.excerpt})]})},{accessorKey:"author",header:"Author",cell:({row:t})=>{const a=t.original.author;return e.jsxs("div",{className:"flex items-center gap-2",children:[a?.avatar_url?e.jsx("img",{src:a.avatar_url,alt:a.full_name||"",className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-xs text-gray-700 font-medium",children:a?.full_name?.[0]||"?"}),e.jsx("span",{className:"text-gray-700",children:a?.full_name||"N/A"})]})}},{accessorKey:"published_at",header:"Published",cell:({row:t})=>{const a=t.original.published_at||t.original.created_at;return e.jsx("span",{className:"text-gray-600 text-sm",children:a?u(new Date(a),"dd/MM/yyyy"):"-"})}},{accessorKey:"created_at",header:"Created",cell:({row:t})=>e.jsx("span",{className:"text-gray-600 text-sm",children:u(new Date(t.original.created_at),"dd/MM/yyyy")})},{id:"media",header:"Media",cell:({row:t})=>e.jsxs("div",{className:"flex gap-2",children:[t.original.featured_image_url&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:"Image"}),t.original.document_url&&e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:"PDF"})]})},{id:"actions",header:"Actions",cell:({row:t})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:`/post/${t.original.slug}`,target:"_blank",className:"text-blue-600 hover:text-blue-700 text-sm",children:"View"}),e.jsx("a",{href:`/admin/posts/edit/${t.original.id}`,className:"text-primary-600 hover:text-primary-700 text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>j(t.original.id),className:"text-red-600 hover:text-red-700 text-sm",children:"Delete"})]})}],[o]),s=N({data:o,columns:i,getCoreRowModel:C(),getFilteredRowModel:S(),getPaginationRowModel:w(),getSortedRowModel:v(),state:{sorting:y,globalFilter:g},onSortingChange:f,onGlobalFilterChange:x,globalFilterFn:(t,a,n)=>{const l=n.toLowerCase();return t.original.title.toLowerCase().includes(l)||t.original.excerpt?.toLowerCase().includes(l)||t.original.author?.full_name?.toLowerCase().includes(l)||t.original.slug.toLowerCase().includes(l)},initialState:{pagination:{pageSize:20}}});return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Posts Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search posts...",value:g,onChange:t=>x(t.target.value),className:"bg-gray-50 border border-gray-200 rounded px-3 py-1 text-gray-900 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500"}),e.jsx("a",{href:"/admin/posts/create",className:"bg-primary-500 hover:bg-primary-600 text-white px-4 py-1 rounded text-sm transition-colors",children:"+ New Post"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm text-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 uppercase font-bold text-xs text-gray-700",children:s.getHeaderGroups().map(t=>e.jsx("tr",{children:t.headers.map(a=>e.jsx("th",{className:"p-3 cursor-pointer hover:bg-gray-100",onClick:a.column.getToggleSortingHandler(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[p(a.column.columnDef.header,a.getContext()),{asc:" ↑",desc:" ↓"}[a.column.getIsSorted()]??null]})},a.id))},t.id))}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:i.length,className:"p-8 text-center text-gray-500",children:"Loading posts..."})}):s.getRowModel().rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:i.length,className:"p-8 text-center text-gray-500",children:"No posts found."})}):s.getRowModel().rows.map(t=>e.jsx("tr",{className:"hover:bg-gray-50 transition-colors",children:t.getVisibleCells().map(a=>e.jsx("td",{className:"p-3",children:p(a.column.columnDef.cell,a.getContext())},a.id))},t.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",s.getState().pagination.pageIndex*s.getState().pagination.pageSize+1," to"," ",Math.min((s.getState().pagination.pageIndex+1)*s.getState().pagination.pageSize,s.getFilteredRowModel().rows.length)," ","of ",s.getFilteredRowModel().rows.length," posts"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsx("button",{onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})]})}export{E as default};
