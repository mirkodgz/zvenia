import{s as l}from"./supabase.D-JsBXyn.js";import"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";const i=document.getElementById("reset-form"),e=document.getElementById("message");let o=!1;async function c(){const r=window.location.hash;if(r&&r.includes("access_token")){const t=new URLSearchParams(r.substring(1)),a=t.get("access_token"),s=t.get("refresh_token");if(t.get("type")==="recovery"&&a)try{const{error:d}=await l.auth.setSession({access_token:a,refresh_token:s||""});if(d){e.textContent="Invalid or expired reset link. Please request a new one.",e.classList.add("bg-red-50","text-red-800","border","border-red-200"),e.classList.remove("hidden"),window.history.replaceState(null,"","/reset-password");return}return window.history.replaceState(null,"","/reset-password"),o=!0,!0}catch{return e.textContent="Error processing reset link. Please try again.",e.classList.add("bg-red-50","text-red-800","border","border-red-200"),e.classList.remove("hidden"),window.history.replaceState(null,"","/reset-password"),!1}}return!1}c().then(r=>{r&&(o=!0)});i.addEventListener("submit",async r=>{r.preventDefault();const t=i.querySelector("#password").value,a=i.querySelector("#confirm-password").value;if(t!==a){e.textContent="Passwords do not match.",e.classList.add("bg-red-50","text-red-800","border","border-red-200"),e.classList.remove("hidden");return}if(t.length<6){e.textContent="Password must be at least 6 characters.",e.classList.add("bg-red-50","text-red-800","border","border-red-200"),e.classList.remove("hidden");return}e.classList.add("hidden"),e.classList.remove("bg-green-50","text-green-800","border-green-200","bg-red-50","text-red-800","border-red-200");try{if(!o&&!await c()){e.textContent="Please use the reset link from your email. The link may have expired.",e.classList.add("bg-red-50","text-red-800","border","border-red-200"),e.classList.remove("hidden");return}if(!o){if(!await c())throw new Error("Please use the reset link from your email. The link may have expired.");o=!0}const{data:{user:s}}=await l.auth.getUser();if(!s)throw new Error("You must be logged in to reset your password. Please use the link from your email.");const{error:n}=await l.auth.updateUser({password:t});if(n)throw n;e.textContent="Password updated successfully! Redirecting to your profile...",e.classList.add("bg-green-50","text-green-800","border","border-green-200"),e.classList.remove("hidden"),setTimeout(()=>{window.location.href="/dashboard/profile"},2e3)}catch(s){e.textContent=s.message||"Failed to update password. The reset link may have expired.",e.classList.add("bg-red-50","text-red-800","border","border-red-200"),e.classList.remove("hidden")}});
