import{j as e}from"./jsx-runtime.BBGWwODT.js";import{r as c}from"./index.DYwCuWnG.js";import"./supabase.D-JsBXyn.js";import"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";function P({currentUser:N,initialData:s,topics:j}){const[r,m]=c.useState({id:s?.id||"",title:s?.title||"",slug:s?.slug||"",excerpt:s?.excerpt||"",content:s?.content||"",featured_image_url:s?.featured_image_url||"",document_url:s?.document_url||"",source:s?.source||"",topic_id:s?.topic_id||"",metadata:s?.metadata||{gallery:[]}}),[p,g]=c.useState(!1),[x,b]=c.useState(!1),[y,w]=c.useState(!!s?.id);c.useEffect(()=>{if(!y&&r.title){const o=r.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");m(t=>({...t,slug:o}))}},[r.title,y]);const d=o=>{const{name:t,value:a}=o.target;m(l=>({...l,[t]:a})),t==="slug"&&w(!0)},h=async(o,t)=>{const a=o.target.files?.[0];if(!a)return;if(t==="pdf"&&a.type!=="application/pdf"){alert("Only PDF files are allowed.");return}if(t==="image"&&!a.type.startsWith("image/")){alert("Only image files are allowed.");return}g(!0);const l=new FormData;l.append("file",a);try{const i=await fetch("/api/upload",{method:"POST",body:l}),n=await i.json();if(!i.ok)throw new Error(n.error||"Upload failed");let u=n.url;t==="image"&&n.format==="pdf"&&(u=u.replace(/\.pdf$/i,".jpg")),m(t==="pdf"?f=>({...f,document_url:u}):f=>({...f,featured_image_url:u}))}catch(i){console.error("Upload Error:",i),alert("Failed to upload file")}finally{g(!1)}},v=async o=>{o.preventDefault(),b(!0);try{const t=!!r.id,a=t?"/api/content/update":"/api/content/create",l={...r,metadata:r.metadata},i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t?l:{type:"post",data:l})}),n=await i.json();if(!i.ok)throw new Error(n.error||"Failed to save post");alert(t?"Post updated successfully!":"Post created successfully!"),window.location.href="/admin/posts"}catch(t){console.error("Submission error:",t),alert(t.message)}finally{b(!1)}};return e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),e.jsx("input",{type:"text",id:"title",name:"title",value:r.title,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter post title"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug *"}),e.jsx("input",{type:"text",id:"slug",name:"slug",value:r.slug,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"post-url-slug"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"URL-friendly version of the title"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"topic_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Topic *"}),e.jsxs("select",{id:"topic_id",name:"topic_id",value:r.topic_id,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Select a topic"}),j.map(o=>e.jsx("option",{value:o.slug,children:o.name},o.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"excerpt",className:"block text-sm font-medium text-gray-700 mb-2",children:"Excerpt"}),e.jsx("textarea",{id:"excerpt",name:"excerpt",value:r.excerpt,onChange:d,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Brief description of the post"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2",children:"Content *"}),e.jsx("textarea",{id:"content",name:"content",value:r.content,onChange:d,required:!0,rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Post content"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Featured Image"}),r.featured_image_url&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:r.featured_image_url,alt:"Featured",className:"w-32 h-32 object-cover rounded-md border border-gray-300"})}),e.jsx("input",{type:"file",accept:"image/*",onChange:o=>h(o,"image"),disabled:p,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"}),p&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Uploading..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PDF Document (Optional)"}),r.document_url&&e.jsx("div",{className:"mb-2",children:e.jsx("a",{href:r.document_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:text-primary-700 text-sm",children:"View PDF"})}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:o=>h(o,"pdf"),disabled:p,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source",className:"block text-sm font-medium text-gray-700 mb-2",children:"Source"}),e.jsx("input",{type:"text",id:"source",name:"source",value:r.source,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Source URL or name"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>window.location.href="/admin/posts",className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Saving...":r.id?"Update Post":"Create Post"})]})]})})}export{P as default};
