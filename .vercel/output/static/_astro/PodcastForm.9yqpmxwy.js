import{j as e}from"./jsx-runtime.BBGWwODT.js";import{r as l}from"./index.DYwCuWnG.js";import{s as I}from"./supabase.D-JsBXyn.js";import"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";const y=()=>Math.random().toString(36).substr(2,9);function H({currentUser:M,initialData:s}){const[f,j]=l.useState([]),[N,w]=l.useState(!0),[a,c]=l.useState({id:s?.id||"",title:s?.title||"",description:s?.description||"",topic_id:s?.topic_slug||s?.topic_id||"",host:s?.host||"",cover_image_url:s?.cover_image_url||s?.featured_image_url||""}),[m,p]=l.useState(s?.episodes?s.episodes.map(r=>({...r,id:y()})):[]),[_,u]=l.useState(null),[b,x]=l.useState(!1);l.useEffect(()=>{(async()=>{const{data:t}=await I.from("topics").select("id, name, slug").order("slug");j(t||[]),w(!1)})()},[]);const i=r=>{const{name:t,value:o}=r.target;c(d=>({...d,[t]:o}))},C=()=>{p(r=>[...r,{id:y(),title:"",video_url:""}])},k=r=>{p(t=>t.filter(o=>o.id!==r))},v=(r,t,o)=>{p(d=>d.map(n=>n.id===r?{...n,[t]:o}:n))},E=async r=>{const t=r.target.files?.[0];if(!t)return;if(!t.type.startsWith("image/")){alert("Only images are allowed.");return}u("cover");const o=new FormData;o.append("file",t);try{const d=await fetch("/api/upload",{method:"POST",body:o}),n=await d.json();if(!d.ok)throw new Error(n.error);c(h=>({...h,cover_image_url:n.url}))}catch(d){console.error(d),alert("Upload failed")}finally{u(null)}},S=async r=>{r.preventDefault(),x(!0);try{const t=!!a.id,o=t?"/api/content/update":"/api/content/create",d=m.map(({title:O,video_url:U},F)=>({number:F+1,title:O,video_url:U})),n={...a,episodes:d,featured_image_url:a.cover_image_url,type:"podcast"},g=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t?n:{type:"podcast",data:n})}),T=await g.json();if(!g.ok)throw new Error(T.error);alert(t?"Podcast updated!":"Podcast created!"),window.location.href="/"}catch(t){console.error(t),alert(t.message)}finally{x(!1)}};if(N)return e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading options..."});const P=!!a.id;return e.jsxs("form",{onSubmit:S,className:"space-y-8 max-w-4xl mx-auto pb-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)] border-b border-[var(--border-color)] pb-2",children:"Podcast Info"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Topic *"}),e.jsxs("select",{name:"topic_id",value:a.topic_id,onChange:i,required:!0,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] appearance-none focus:border-primary-500 outline-none",children:[e.jsx("option",{value:"",children:"Select a Topic"}),f.map(r=>e.jsx("option",{value:r.slug,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Podcast Name / Title *"}),e.jsx("input",{type:"text",name:"title",value:a.title,onChange:i,required:!0,placeholder:"e.g. Mining Insights Weekly",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Host Name"}),e.jsx("input",{type:"text",name:"host",value:a.host,onChange:i,placeholder:"e.g. Mahlogonolo Mashile",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Cover Art"}),a.cover_image_url?e.jsxs("div",{className:"relative w-48 h-48 rounded-lg overflow-hidden border border-[var(--border-color)] group",children:[e.jsx("img",{src:a.cover_image_url,alt:"Cover",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>c(r=>({...r,cover_image_url:""})),className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white font-bold",children:"Remove"})]}):e.jsxs("div",{className:"border-2 border-dashed border-[var(--border-color)] rounded-lg p-6 text-center hover:border-primary-500/50 transition-colors bg-[var(--bg-body)] w-full md:w-1/2",children:[e.jsx("input",{type:"file",id:"cover-upload",className:"hidden",accept:"image/*",onChange:E}),e.jsx("label",{htmlFor:"cover-upload",className:"cursor-pointer text-primary-400 hover:text-primary-300 block",children:_==="cover"?"Uploading...":"Upload Cover Image"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Description"}),e.jsx("textarea",{name:"description",rows:4,value:a.description,onChange:i,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none font-mono text-sm",placeholder:"About this podcast..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-[var(--border-color)] pb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)]",children:"Episodes"}),e.jsx("button",{type:"button",onClick:C,className:"bg-primary-600 hover:bg-primary-500 text-white text-sm px-3 py-1 rounded-md transition-colors",children:"+ Add Episode"})]}),m.length===0&&e.jsx("div",{className:"text-center py-8 text-[var(--text-secondary)] italic bg-[var(--bg-surface)] rounded-lg border border-[var(--border-color)]",children:"No episodes added yet."}),e.jsx("div",{className:"space-y-3",children:m.map((r,t)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-[var(--bg-surface)] p-4 rounded-lg border border-[var(--border-color)] animate-fade-in-up",children:[e.jsxs("div",{className:"md:col-span-1 text-center font-mono text-[var(--text-secondary)] text-sm py-3",children:["#",t+1]}),e.jsxs("div",{className:"md:col-span-5",children:[e.jsx("label",{className:"block text-xs text-[var(--text-secondary)] mb-1",children:"Episode Title"}),e.jsx("input",{type:"text",value:r.title,onChange:o=>v(r.id,"title",o.target.value),placeholder:"Episode Title",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded px-3 py-2 text-sm text-[var(--text-main)] focus:border-primary-500 outline-none"})]}),e.jsxs("div",{className:"md:col-span-5",children:[e.jsx("label",{className:"block text-xs text-[var(--text-secondary)] mb-1",children:"YouTube / Video URL"}),e.jsx("input",{type:"url",value:r.video_url,onChange:o=>v(r.id,"video_url",o.target.value),placeholder:"https://youtube.com/...",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded px-3 py-2 text-sm text-[var(--text-main)] focus:border-primary-500 outline-none"})]}),e.jsx("div",{className:"md:col-span-1 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>k(r.id),className:"text-red-500 hover:text-red-400 p-2",title:"Remove",children:"ðŸ—‘ï¸"})})]},r.id))})]}),e.jsxs("div",{className:"pt-6 border-t border-[var(--border-color)] flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>window.location.href="/",className:"mr-3 inline-flex justify-center rounded-md border border-[var(--border-color)] bg-transparent py-3 px-8 text-sm font-medium text-[var(--text-secondary)] shadow-sm hover:bg-[var(--bg-surface-hover)] hover:text-[var(--text-main)] focus:outline-none transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"inline-flex justify-center rounded-md border border-transparent bg-primary-600 py-3 px-8 text-sm font-bold text-white shadow-sm hover:bg-primary-500 focus:outline-none transition-all transform hover:scale-105 disabled:opacity-50",children:b?"Saving...":P?"ðŸ’¾ Update Podcast":"ðŸš€ Publish Podcast"})]})]})}export{H as default};
