import{j as e}from"./jsx-runtime.BBGWwODT.js";import{r as i}from"./index.DYwCuWnG.js";import{f as R,u as I,a as j,g as L,b as P,c as F,d as z}from"./format.-X2iPvTI.js";import{c as B}from"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";const A=["Administrator","CountryManager","Ads","Events","Expert","Basic"];function Z(){const[c,u]=i.useState([]),[N,y]=i.useState(!0),[h,b]=i.useState(""),[v,C]=i.useState([]),[d,x]=i.useState(null),[n,g]=i.useState({role:"Basic",work_country:""}),m=B("https://ddgdtdhgaqeqnoigmfrh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZ2R0ZGhnYXFlcW5vaWdtZnJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwNDE3NjMsImV4cCI6MjA4MjYxNzc2M30.aSW3Ds1z-8ta1sx-22P3NGyx4jzaY0aGNPPB9PsFcs0");i.useEffect(()=>{f()},[]);const f=async()=>{y(!0);let r=[],t=0;const s=1e3;let o=!0;for(;o;){const{data:a,error:w}=await m.from("profiles").select("*").order("created_at",{ascending:!1}).range(t*s,(t+1)*s-1);if(w){console.error("Error fetching users:",w),alert("Error fetching users");break}a&&a.length>0?(r=[...r,...a],o=a.length===s,t++):o=!1}u(r),y(!1)},S=async r=>{if(!confirm("Are you sure you want to delete this user? This action cannot be undone."))return;const{error:t}=await m.from("profiles").delete().eq("id",r);t?(console.error("Error deleting user:",t),alert("Error deleting user")):u(c.filter(s=>s.id!==r))},_=r=>{x(r.id),g({role:r.role||"Basic",work_country:r.work_country||""})},k=()=>{x(null),g({role:"Basic",work_country:""})},M=async r=>{const{error:t}=await m.from("profiles").update({role:n.role,work_country:n.work_country||null}).eq("id",r);t?(console.error("Error updating user:",t),alert("Error updating user: "+t.message)):(u(c.map(s=>s.id===r?{...s,role:n.role,work_country:n.work_country||null}:s)),x(null))},E=r=>{switch(r){case"Administrator":return"border-red-500/30 bg-red-500/10 text-red-400";case"CountryManager":return"border-blue-500/30 bg-blue-500/10 text-blue-400";case"Expert":return"border-purple-500/30 bg-purple-500/10 text-purple-400";case"Ads":return"border-yellow-500/30 bg-yellow-500/10 text-yellow-400";case"Events":return"border-green-500/30 bg-green-500/10 text-green-400";default:return"border-gray-500/30 bg-gray-500/10 text-gray-400"}},p=i.useMemo(()=>[{accessorKey:"full_name",header:"User",cell:({row:r})=>{const t=r.original,s=t.full_name||(t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:null)||t.email?.split("@")[0]||"N/A";return e.jsxs("div",{className:"flex items-center gap-2",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:s,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-xs text-gray-700 font-medium",children:s[0]?.toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s}),t.username&&e.jsxs("div",{className:"text-xs text-gray-500",children:["@",t.username]})]})]})}},{accessorKey:"email",header:"Email",cell:({row:r})=>e.jsx("span",{className:"text-gray-700 text-sm",children:r.original.email})},{accessorKey:"role",header:"Role",cell:({row:r})=>{const t=r.original;return d===t.id?e.jsx("select",{value:n.role,onChange:s=>g({...n,role:s.target.value}),className:"bg-white border border-primary-500 rounded px-2 py-1 text-gray-900 outline-none text-sm",onClick:s=>s.stopPropagation(),children:A.map(s=>e.jsx("option",{value:s,children:s},s))}):e.jsx("span",{className:`px-2 py-1 rounded text-xs border ${E(t.role)}`,children:t.role||"Basic"})}},{accessorKey:"company",header:"Company",cell:({row:r})=>e.jsx("span",{className:"text-gray-600 text-sm",children:r.original.company||"-"})},{accessorKey:"position",header:"Position",cell:({row:r})=>e.jsx("span",{className:"text-gray-600 text-sm",children:r.original.position||"-"})},{accessorKey:"work_country",header:"Country",cell:({row:r})=>{const t=r.original;return d===t.id?e.jsx("input",{type:"text",value:n.work_country,onChange:s=>g({...n,work_country:s.target.value}),placeholder:"Country...",className:"bg-white border border-primary-500 rounded px-2 py-1 text-gray-900 outline-none text-sm w-32",onClick:s=>s.stopPropagation()}):e.jsx("span",{className:"text-gray-600 text-sm",children:t.work_country||t.nationality||"-"})}},{accessorKey:"profession",header:"Profession",cell:({row:r})=>e.jsx("span",{className:"text-gray-600 text-sm",children:r.original.profession||"-"})},{accessorKey:"created_at",header:"Created",cell:({row:r})=>e.jsx("span",{className:"text-gray-600 text-sm",children:R(new Date(r.original.created_at),"dd/MM/yyyy")})},{id:"actions",header:"Actions",cell:({row:r})=>{const t=r.original;return d===t.id?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(t.id),className:"text-green-600 hover:text-green-700 text-sm",children:"Save"}),e.jsx("button",{onClick:k,className:"text-gray-500 hover:text-gray-600 text-sm",children:"Cancel"})]}):e.jsxs("div",{className:"flex gap-2",children:[t.profile_slug&&e.jsx("a",{href:`/profile/${t.profile_slug}/zv-user`,target:"_blank",className:"text-blue-600 hover:text-blue-700 text-sm",children:"View"}),e.jsx("button",{onClick:()=>_(t),className:"text-primary-600 hover:text-primary-700 text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>S(t.id),className:"text-red-600 hover:text-red-700 text-sm",children:"Delete"})]})}}],[c,d,n]),l=I({data:c,columns:p,getCoreRowModel:z(),getFilteredRowModel:F(),getPaginationRowModel:P(),getSortedRowModel:L(),state:{sorting:v,globalFilter:h},onSortingChange:C,onGlobalFilterChange:b,globalFilterFn:(r,t,s)=>{const o=s.toLowerCase(),a=r.original;return a.email?.toLowerCase().includes(o)||a.full_name?.toLowerCase().includes(o)||a.first_name?.toLowerCase().includes(o)||a.last_name?.toLowerCase().includes(o)||a.company?.toLowerCase().includes(o)||a.position?.toLowerCase().includes(o)||a.profession?.toLowerCase().includes(o)||a.work_country?.toLowerCase().includes(o)||a.nationality?.toLowerCase().includes(o)||a.role?.toLowerCase().includes(o)||a.username?.toLowerCase().includes(o)||!1},initialState:{pagination:{pageSize:20}}});return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"User Management"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Total: ",c.length," users"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:h,onChange:r=>b(r.target.value),className:"bg-gray-50 border border-gray-200 rounded px-3 py-1 text-gray-900 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 w-64"}),e.jsx("button",{onClick:f,className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-4 py-1 rounded text-sm transition-colors",title:"Refresh list",children:"↻"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm text-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 uppercase font-bold text-xs text-gray-700",children:l.getHeaderGroups().map(r=>e.jsx("tr",{children:r.headers.map(t=>e.jsx("th",{className:"p-3 cursor-pointer hover:bg-gray-100",onClick:t.column.getToggleSortingHandler(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[j(t.column.columnDef.header,t.getContext()),{asc:" ↑",desc:" ↓"}[t.column.getIsSorted()]??null]})},t.id))},r.id))}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:N?e.jsx("tr",{children:e.jsx("td",{colSpan:p.length,className:"p-8 text-center text-gray-500",children:"Loading users..."})}):l.getRowModel().rows.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:p.length,className:"p-8 text-center text-gray-500",children:"No users found."})}):l.getRowModel().rows.map(r=>e.jsx("tr",{className:"hover:bg-gray-50 transition-colors",children:r.getVisibleCells().map(t=>e.jsx("td",{className:"p-3",children:j(t.column.columnDef.cell,t.getContext())},t.id))},r.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",l.getState().pagination.pageIndex*l.getState().pagination.pageSize+1," a"," ",Math.min((l.getState().pagination.pageIndex+1)*l.getState().pagination.pageSize,l.getFilteredRowModel().rows.length)," ","of ",l.getFilteredRowModel().rows.length," users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l.previousPage(),disabled:!l.getCanPreviousPage(),className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsx("button",{onClick:()=>l.nextPage(),disabled:!l.getCanNextPage(),className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})]})}export{Z as default};
