import{j as t}from"./jsx-runtime.BBGWwODT.js";import{r as i}from"./index.DYwCuWnG.js";import{f as R,u as I,a as j,g as L,b as P,c as F,d as z}from"./format.-X2iPvTI.js";import{c as B}from"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";const A=["Administrator","CountryManager","Ads","Events","Expert","Basic"];function Z(){const[c,u]=i.useState([]),[N,p]=i.useState(!0),[y,h]=i.useState(""),[v,C]=i.useState([]),[d,x]=i.useState(null),[l,g]=i.useState({role:"Basic",work_country:""}),b=B("https://ddgdtdhgaqeqnoigmfrh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZ2R0ZGhnYXFlcW5vaWdtZnJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwNDE3NjMsImV4cCI6MjA4MjYxNzc2M30.aSW3Ds1z-8ta1sx-22P3NGyx4jzaY0aGNPPB9PsFcs0");i.useEffect(()=>{f()},[]);const f=async()=>{p(!0);let r=[],e=0;const s=1e3;let o=!0;for(;o;){const{data:a,error:w}=await b.from("profiles").select("*").order("created_at",{ascending:!1}).range(e*s,(e+1)*s-1);if(w){console.error("Error fetching users:",w),alert("Error fetching users");break}a&&a.length>0?(r=[...r,...a],o=a.length===s,e++):o=!1}u(r),p(!1)},S=async r=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const e=await fetch(`/api/admin/users/action?id=${r}`,{method:"DELETE"});if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to delete")}u(c.filter(s=>s.id!==r))}catch(e){console.error("Error deleting user:",e),alert("Error deleting user: "+e.message)}},_=r=>{x(r.id),g({role:r.role||"Basic",work_country:r.work_country||""})},k=()=>{x(null),g({role:"Basic",work_country:""})},E=async r=>{const{error:e}=await b.from("profiles").update({role:l.role,work_country:l.work_country||null}).eq("id",r);e?(console.error("Error updating user:",e),alert("Error updating user: "+e.message)):(u(c.map(s=>s.id===r?{...s,role:l.role,work_country:l.work_country||null}:s)),x(null))},M=r=>{switch(r){case"Administrator":return"border-red-500/30 bg-red-500/10 text-red-400";case"CountryManager":return"border-blue-500/30 bg-blue-500/10 text-blue-400";case"Expert":return"border-purple-500/30 bg-purple-500/10 text-purple-400";case"Ads":return"border-yellow-500/30 bg-yellow-500/10 text-yellow-400";case"Events":return"border-green-500/30 bg-green-500/10 text-green-400";default:return"border-gray-500/30 bg-gray-500/10 text-gray-400"}},m=i.useMemo(()=>[{accessorKey:"full_name",header:"User",cell:({row:r})=>{const e=r.original,s=e.full_name||(e.first_name&&e.last_name?`${e.first_name} ${e.last_name}`:null)||e.email?.split("@")[0]||"N/A";return t.jsxs("div",{className:"flex items-center gap-2",children:[e.avatar_url?t.jsx("img",{src:e.avatar_url,alt:s,className:"w-8 h-8 rounded-full object-cover"}):t.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-xs text-gray-700 font-medium",children:s[0]?.toUpperCase()||"?"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:s}),e.username&&t.jsxs("div",{className:"text-xs text-gray-500",children:["@",e.username]})]})]})}},{accessorKey:"email",header:"Email",cell:({row:r})=>t.jsx("span",{className:"text-gray-700 text-sm",children:r.original.email})},{accessorKey:"role",header:"Role",cell:({row:r})=>{const e=r.original;return d===e.id?t.jsx("select",{value:l.role,onChange:s=>g({...l,role:s.target.value}),className:"bg-white border border-primary-500 rounded px-2 py-1 text-gray-900 outline-none text-sm",onClick:s=>s.stopPropagation(),children:A.map(s=>t.jsx("option",{value:s,children:s},s))}):t.jsx("span",{className:`px-2 py-1 rounded text-xs border ${M(e.role)}`,children:e.role||"Basic"})}},{accessorKey:"company",header:"Company",cell:({row:r})=>t.jsx("span",{className:"text-gray-600 text-sm",children:r.original.company||"-"})},{accessorKey:"position",header:"Position",cell:({row:r})=>t.jsx("span",{className:"text-gray-600 text-sm",children:r.original.position||"-"})},{accessorKey:"work_country",header:"Country",cell:({row:r})=>{const e=r.original;return d===e.id?t.jsx("input",{type:"text",value:l.work_country,onChange:s=>g({...l,work_country:s.target.value}),placeholder:"Country...",className:"bg-white border border-primary-500 rounded px-2 py-1 text-gray-900 outline-none text-sm w-32",onClick:s=>s.stopPropagation()}):t.jsx("span",{className:"text-gray-600 text-sm",children:e.work_country||e.nationality||"-"})}},{accessorKey:"profession",header:"Profession",cell:({row:r})=>t.jsx("span",{className:"text-gray-600 text-sm",children:r.original.profession||"-"})},{accessorKey:"created_at",header:"Created",cell:({row:r})=>t.jsx("span",{className:"text-gray-600 text-sm",children:R(new Date(r.original.created_at),"dd/MM/yyyy")})},{id:"actions",header:"Actions",cell:({row:r})=>{const e=r.original;return d===e.id?t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>E(e.id),className:"text-green-600 hover:text-green-700 text-sm",children:"Save"}),t.jsx("button",{onClick:k,className:"text-gray-500 hover:text-gray-600 text-sm",children:"Cancel"})]}):t.jsxs("div",{className:"flex gap-2",children:[e.profile_slug&&t.jsx("a",{href:`/profile/${e.profile_slug}/zv-user`,target:"_blank",className:"text-blue-600 hover:text-blue-700 text-sm",children:"View"}),t.jsx("button",{onClick:()=>_(e),className:"text-primary-600 hover:text-primary-700 text-sm",children:"Edit"}),t.jsx("button",{onClick:()=>S(e.id),className:"text-red-600 hover:text-red-700 text-sm",children:"Delete"})]})}}],[c,d,l]),n=I({data:c,columns:m,getCoreRowModel:z(),getFilteredRowModel:F(),getPaginationRowModel:P(),getSortedRowModel:L(),state:{sorting:v,globalFilter:y},onSortingChange:C,onGlobalFilterChange:h,globalFilterFn:(r,e,s)=>{const o=s.toLowerCase(),a=r.original;return a.email?.toLowerCase().includes(o)||a.full_name?.toLowerCase().includes(o)||a.first_name?.toLowerCase().includes(o)||a.last_name?.toLowerCase().includes(o)||a.company?.toLowerCase().includes(o)||a.position?.toLowerCase().includes(o)||a.profession?.toLowerCase().includes(o)||a.work_country?.toLowerCase().includes(o)||a.nationality?.toLowerCase().includes(o)||a.role?.toLowerCase().includes(o)||a.username?.toLowerCase().includes(o)||!1},initialState:{pagination:{pageSize:20}}});return t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"User Management"}),t.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Total: ",c.length," users"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",placeholder:"Search users...",value:y,onChange:r=>h(r.target.value),className:"bg-gray-50 border border-gray-200 rounded px-3 py-1 text-gray-900 text-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 w-64"}),t.jsx("button",{onClick:f,className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-4 py-1 rounded text-sm transition-colors",title:"Refresh list",children:"↻"})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left text-sm text-gray-600",children:[t.jsx("thead",{className:"bg-gray-50 uppercase font-bold text-xs text-gray-700",children:n.getHeaderGroups().map(r=>t.jsx("tr",{children:r.headers.map(e=>t.jsx("th",{className:"p-3 cursor-pointer hover:bg-gray-100",onClick:e.column.getToggleSortingHandler(),children:t.jsxs("div",{className:"flex items-center gap-2",children:[j(e.column.columnDef.header,e.getContext()),{asc:" ↑",desc:" ↓"}[e.column.getIsSorted()]??null]})},e.id))},r.id))}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:N?t.jsx("tr",{children:t.jsx("td",{colSpan:m.length,className:"p-8 text-center text-gray-500",children:"Loading users..."})}):n.getRowModel().rows.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:m.length,className:"p-8 text-center text-gray-500",children:"No users found."})}):n.getRowModel().rows.map(r=>t.jsx("tr",{className:"hover:bg-gray-50 transition-colors",children:r.getVisibleCells().map(e=>t.jsx("td",{className:"p-3",children:j(e.column.columnDef.cell,e.getContext())},e.id))},r.id))})]})}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",n.getState().pagination.pageIndex*n.getState().pagination.pageSize+1," a"," ",Math.min((n.getState().pagination.pageIndex+1)*n.getState().pagination.pageSize,n.getFilteredRowModel().rows.length)," ","of ",n.getFilteredRowModel().rows.length," users"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>n.previousPage(),disabled:!n.getCanPreviousPage(),className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),t.jsx("button",{onClick:()=>n.nextPage(),disabled:!n.getCanNextPage(),className:"bg-gray-100 hover:bg-gray-200 border border-gray-200 text-gray-700 px-3 py-1 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})]})}export{Z as default};
