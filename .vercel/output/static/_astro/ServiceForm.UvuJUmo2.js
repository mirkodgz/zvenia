import{j as e}from"./jsx-runtime.BBGWwODT.js";import{r as i}from"./index.DYwCuWnG.js";import{s as m}from"./supabase.D-JsBXyn.js";import"./index.BWsCvz9k.js";import"./tslib.es6.eMSY344_.js";function z({currentUser:C,initialData:o}){const[g,h]=i.useState(!0),[y,f]=i.useState([]),[j,_]=i.useState([]),[N,w]=i.useState([]),[t,c]=i.useState({id:o?.id||"",title:o?.title||"",description:o?.description||"",topic_id:o?.topic_id||"",type_id:o?.type_id||"",duration_id:o?.duration_id||"",target_country:o?.target_country||"",organizer_company:o?.organizer_company||"",company_link:o?.company_link||"",contact_email:o?.contact_email||"",quick_view_image_url:o?.quick_view_image_url||o?.featured_image_url||""}),[p,x]=i.useState(!1),[u,b]=i.useState(!1);i.useEffect(()=>{(async()=>{try{const[{data:a},{data:l},{data:n}]=await Promise.all([m.from("service_types").select("*").order("name"),m.from("service_durations").select("*").order("name"),m.from("topics").select("id, name, slug").order("name")]);f(a||[]),_(l||[]),w(n||[])}catch(a){console.error("Error fetching options:",a)}finally{h(!1)}})()},[]);const s=r=>{c(a=>({...a,[r.target.name]:r.target.value}))},k=async r=>{const a=r.target.files?.[0];if(!a)return;x(!0);const l=new FormData;l.append("file",a);try{const n=await fetch("/api/upload",{method:"POST",body:l}),d=await n.json();if(!n.ok)throw new Error(d.error);c(v=>({...v,quick_view_image_url:d.url}))}catch{alert("Upload failed")}finally{x(!1)}},S=async r=>{r.preventDefault(),b(!0);try{const a=!!t.id,l=a?"/api/content/update":"/api/content/create",n={...t,type:"service",featured_image_url:t.quick_view_image_url};if(!(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a?n:{type:"service",data:n})})).ok)throw new Error("Failed to save service");alert(a?"Service updated!":"Service created!"),window.location.href="/"}catch(a){alert(a.message)}finally{b(!1)}};return g?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading options..."}):e.jsxs("form",{onSubmit:S,className:"space-y-8 max-w-4xl mx-auto pb-12",children:[e.jsxs("div",{className:"border-b border-[var(--border-color)] pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-[var(--text-main)] mb-1",children:t.id?"Edit Service":"Create New Service"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"Promote your services to the Zvenia community."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)]",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Service Title *"}),e.jsx("input",{type:"text",name:"title",required:!0,value:t.title,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none",placeholder:"e.g. Geological Consulting"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Topic *"}),e.jsxs("select",{name:"topic_id",required:!0,value:t.topic_id,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Topic"}),N.map(r=>e.jsx("option",{value:r.slug,children:r.name},r.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Description"}),e.jsx("textarea",{name:"description",rows:4,value:t.description,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] outline-none",placeholder:"Describe your service..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)]",children:"Classification"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Type of Ad *"}),e.jsxs("select",{name:"type_id",required:!0,value:t.type_id,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Type"}),y.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Campaign Duration"}),e.jsxs("select",{name:"duration_id",value:t.duration_id,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Duration"}),j.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Target Country"}),e.jsx("input",{type:"text",name:"target_country",value:t.target_country,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)]",placeholder:"e.g. Peru"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)]",children:"Visuals"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Quick View Image (Card)"}),t.quick_view_image_url?e.jsxs("div",{className:"relative w-48 h-32 rounded bg-gray-800 overflow-hidden border border-[var(--border-color)] group",children:[e.jsx("img",{src:t.quick_view_image_url,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>c(r=>({...r,quick_view_image_url:""})),className:"absolute inset-0 bg-black/50 text-red-500 opacity-0 group-hover:opacity-100 flex items-center justify-center font-bold",children:"Remove"})]}):e.jsx("div",{className:"w-full h-32 border-2 border-dashed border-[var(--border-color)] rounded-lg flex items-center justify-center hover:border-primary-500/50 transition-colors",children:e.jsxs("label",{className:"cursor-pointer text-[var(--text-secondary)] hover:text-white",children:[p?"Uploading...":"Upload Image",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:k})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)]",children:"Organizer / Company"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Company Name"}),e.jsx("input",{type:"text",name:"organizer_company",value:t.organizer_company,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Company Link"}),e.jsx("input",{type:"url",name:"company_link",value:t.company_link,onChange:s,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)]",placeholder:"https://"})]})]})]}),e.jsxs("div",{className:"pt-6 flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>window.history.back(),className:"px-6 py-3 rounded-lg border border-[var(--border-color)] text-[var(--text-secondary)] hover:bg-[var(--bg-surface-hover)] transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u||p,className:"px-6 py-3 rounded-lg bg-primary-600 text-white font-bold hover:bg-primary-700 transition-colors disabled:opacity-50",children:u?"Saving...":t.id?"Update Service":"Create Service"})]})]})}export{z as default};
