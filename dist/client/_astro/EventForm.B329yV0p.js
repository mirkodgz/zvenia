import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.WFquGv8Z.js";import{s as p}from"./supabase.E32zLJp1.js";import"./index.DkUcqVkk.js";function G({currentUser:q,initialData:a}){const b=r=>r?r.substring(0,10):"",[_,j]=d.useState([]),[N,w]=d.useState([]),[k,z]=d.useState([]),[C,E]=d.useState([]),[S,F]=d.useState([]),[P,O]=d.useState(!0),[t,u]=d.useState({id:a?.id||"",title:a?.title||"",slug:a?.slug||"",description:a?.description||"",topic_id:a?.topic_slug||"",type_id:a?.type_id||a?.event_type_id||"",language_id:a?.language_id||a?.event_language_id||"",format_id:a?.format_id||a?.event_format_id||"",price_id:a?.price_id||a?.event_price_id||"",start_date:b(a?.start_date),end_date:b(a?.end_date),start_time:a?.start_time||"",location:a?.location||"",cover_photo_url:a?.featured_image_url||a?.cover_photo_url||"",schedule_pdf_url:a?.document_url||a?.metadata?.document_url||"",organizer:a?.organizer||a?.metadata?.organizer||"",organizer_phone:a?.organizer_phone||a?.metadata?.organizer_phone||"",organizer_email:a?.organizer_email||a?.metadata?.organizer_email||"",official_link:a?.external_link||""}),[v,g]=d.useState(null),[h,f]=d.useState(!1),[L,T]=d.useState(!1);d.useEffect(()=>{(async()=>{try{const[{data:o},{data:n},{data:c},{data:s},{data:i}]=await Promise.all([p.from("topics").select("id, name, slug").order("slug"),p.from("event_types").select("*").order("name"),p.from("event_languages").select("*").order("name"),p.from("event_formats").select("*").order("name"),p.from("event_prices").select("*").order("name")]);j(o||[]),w(n||[]),z(c||[]),E(s||[]),F(i||[])}catch(o){console.error("Error fetching event options:",o)}finally{O(!1)}})()},[]);const l=r=>{const{name:o,value:n}=r.target;u(c=>{const s={...c,[o]:n};return o==="title"&&!L&&!c.id&&(s.slug=n.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")),s}),o==="slug"&&T(!0)},y=async(r,o)=>{const n=r.target.files?.[0];if(!n)return;if(o==="cover_photo_url"&&!n.type.startsWith("image/")){alert("Only images are allowed for the cover photo.");return}if(o==="schedule_pdf_url"&&n.type!=="application/pdf"){alert("Only PDF files are allowed for the schedule.");return}g(o);const c=new FormData;c.append("file",n);try{const s=await fetch("/api/upload",{method:"POST",body:c}),i=await s.json();if(!s.ok)throw new Error(i.error||"Upload failed");let m=i.url;o==="cover_photo_url"&&i.format==="pdf"&&(m=m.replace(/\.pdf$/i,".jpg")),u(x=>({...x,[o]:m}))}catch(s){console.error("Upload Error:",s),alert("Failed to upload file")}finally{g(null)}},U=async r=>{r.preventDefault(),f(!0);try{const o=!!t.id,n=o?"/api/content/update":"/api/content/create",c={organizer:t.organizer,organizer_email:t.organizer_email,organizer_phone:t.organizer_phone},s={...t,type:"event",featured_image_url:t.cover_photo_url,document_url:t.schedule_pdf_url,external_link:t.official_link,event_type_id:t.type_id||null,event_language_id:t.language_id||null,event_format_id:t.format_id||null,event_price_id:t.price_id||null,metadata:c,organizer:t.organizer,organizer_email:t.organizer_email,organizer_phone:t.organizer_phone},m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o?s:{type:"event",data:s})}),x=await m.json();if(!m.ok)throw new Error(x.error||"Failed to save event");alert(o?"Event updated successfully!":"Event created successfully!"),window.location.href="/"}catch(o){console.error("Submission error:",o),alert(o.message)}finally{f(!1)}};if(P)return e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading form options..."});const R=!!t.id;return e.jsxs("form",{onSubmit:U,className:"space-y-8 max-w-4xl mx-auto pb-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)] border-b border-[var(--border-color)] pb-2",children:"Event Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Topic *"}),e.jsxs("select",{name:"topic_id",value:t.topic_id,onChange:l,required:!0,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] appearance-none focus:border-primary-500 outline-none",children:[e.jsx("option",{value:"",children:"Select a Topic"}),_.map(r=>e.jsx("option",{value:r.slug,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Event Title *"}),e.jsx("input",{type:"text",name:"title",value:t.title,onChange:l,required:!0,placeholder:"e.g. International Mining Congress 2026",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Event URL Slug *"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"bg-[var(--bg-surface)] border border-r-0 border-[var(--border-color)] rounded-l-lg px-3 py-3 text-gray-500 text-sm",children:"/event/"}),e.jsx("input",{type:"text",name:"slug",value:t.slug,onChange:l,required:!0,placeholder:"event-url-slug",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-r-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none"})]}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mt-1",children:"This will be the unique link for your event."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Event Cover Photo (1050x350 Recommended)"}),t.cover_photo_url?e.jsxs("div",{className:"relative w-full h-48 rounded-lg overflow-hidden border border-[var(--border-color)] group",children:[e.jsx("img",{src:t.cover_photo_url,alt:"Cover",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{type:"button",onClick:()=>u(r=>({...r,cover_photo_url:""})),className:"bg-red-600 text-white px-3 py-1 rounded-full text-sm",children:"Remove Image"})})]}):e.jsx("div",{className:"border-2 border-dashed border-[var(--border-color)] rounded-lg p-8 text-center hover:border-primary-500/50 transition-colors bg-[var(--bg-body)]",children:v==="cover_photo_url"?e.jsx("span",{className:"text-[var(--text-secondary)]",children:"Uploading..."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"cover-upload",className:"hidden",accept:"image/*",onChange:r=>y(r,"cover_photo_url")}),e.jsx("label",{htmlFor:"cover-upload",className:"cursor-pointer text-primary-400 hover:text-primary-300",children:"Click to upload image"}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mt-1",children:"Recommended size: 1050 x 350 px"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)] border-b border-[var(--border-color)] pb-2",children:"Date & Location"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Start Date *"}),e.jsx("input",{type:"date",name:"start_date",required:!0,value:t.start_date,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] [color-scheme:dark] dark:[color-scheme:dark] light:[color-scheme:light]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"End Date *"}),e.jsx("input",{type:"date",name:"end_date",required:!0,value:t.end_date,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] [color-scheme:dark] dark:[color-scheme:dark] light:[color-scheme:light]"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Start Time"}),e.jsx("input",{type:"time",name:"start_time",value:t.start_time,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] [color-scheme:dark] dark:[color-scheme:dark] light:[color-scheme:light]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Location / Venue"}),e.jsx("input",{type:"text",name:"location",value:t.location,onChange:l,placeholder:"e.g. Lima Convention Center",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)]"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)] border-b border-[var(--border-color)] pb-2",children:"Classification"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Event Type"}),e.jsxs("select",{name:"type_id",value:t.type_id,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Type"}),N.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Format"}),e.jsxs("select",{name:"format_id",value:t.format_id,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Format"}),C.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Language"}),e.jsxs("select",{name:"language_id",value:t.language_id,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Language"}),k.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Price Category"}),e.jsxs("select",{name:"price_id",value:t.price_id,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)] appearance-none",children:[e.jsx("option",{value:"",children:"Select Price"}),S.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--text-main)] border-b border-[var(--border-color)] pb-2",children:"Resources & Organizer"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Event Program / Schedule (PDF) (Optional)"}),t.schedule_pdf_url?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[var(--bg-surface)] border border-[var(--border-color)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary-400",children:[e.jsx("span",{children:"ðŸ“„"}),e.jsx("a",{href:t.schedule_pdf_url,target:"_blank",className:"text-sm hover:underline",children:"View Uploaded Program"})]}),e.jsx("button",{type:"button",onClick:()=>u(r=>({...r,schedule_pdf_url:""})),className:"text-red-500 hover:text-red-400 text-sm",children:"Remove"})]}):e.jsx("div",{className:"border border-dashed border-[var(--border-color)] rounded-lg p-4 text-center hover:border-primary-500/50 transition-colors bg-[var(--bg-body)]",children:v==="schedule_pdf_url"?e.jsx("span",{className:"text-[var(--text-secondary)]",children:"Uploading PDF..."}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",id:"pdf-upload",className:"hidden",accept:"application/pdf",onChange:r=>y(r,"schedule_pdf_url")}),e.jsxs("label",{htmlFor:"pdf-upload",className:"cursor-pointer text-sm text-[var(--text-secondary)] hover:text-[var(--text-main)] flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸ“Ž"})," Upload Program PDF"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Organizer Name"}),e.jsx("input",{type:"text",name:"organizer",value:t.organizer,onChange:l,placeholder:"Company or Group Name",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Organizer Email"}),e.jsx("input",{type:"email",name:"organizer_email",value:t.organizer_email,onChange:l,placeholder:"contact@organizer.com",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Organizer Phone"}),e.jsx("input",{type:"tel",name:"organizer_phone",value:t.organizer_phone,onChange:l,placeholder:"+1 234 567 890",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Official Event Link"}),e.jsx("input",{type:"url",name:"official_link",value:t.official_link,onChange:l,placeholder:"https://...",className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-3 py-2 text-[var(--text-main)]"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:"Full Description"}),e.jsx("textarea",{name:"description",rows:6,value:t.description,onChange:l,className:"w-full bg-[var(--bg-body)] border border-[var(--border-color)] rounded-lg px-4 py-3 text-[var(--text-main)] focus:border-primary-500 outline-none font-mono text-sm",placeholder:"Detailed information about the event..."})]}),e.jsxs("div",{className:"pt-6 border-t border-[var(--border-color)] flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>window.location.href="/",className:"mr-3 inline-flex justify-center rounded-md border border-[var(--border-color)] bg-transparent py-3 px-8 text-sm font-medium text-[var(--text-secondary)] shadow-sm hover:bg-[var(--bg-surface-hover)] hover:text-[var(--text-main)] focus:outline-none transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"inline-flex justify-center rounded-md border border-transparent bg-primary-600 py-3 px-8 text-sm font-bold text-white shadow-sm hover:bg-primary-500 focus:outline-none transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Saving...":R?"ðŸ’¾ Update Event":"ðŸš€ Publish Event"})]})]})}export{G as default};
