import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.WFquGv8Z.js";import{s as f}from"./supabase.E32zLJp1.js";import"./index.DkUcqVkk.js";function y({targetUserId:l,currentUserId:t}){const[u,s]=r.useState(!1),[h,a]=r.useState(!0),m=l===t,c=r.useRef(!1);r.useEffect(()=>{if(!t||m){a(!1);return}p();const o=setTimeout(()=>a(!1),3e3);return()=>clearTimeout(o)},[l,t]);const p=async()=>{try{const{data:o,error:n}=await f.from("social_connections").select("id").eq("follower_id",t).eq("following_id",l).maybeSingle();o&&s(!0)}catch(o){console.error("Error checking follow status:",o)}finally{a(!1)}},w=async o=>{if(o.preventDefault(),o.stopPropagation(),!t){alert("Please sign in to follow users.");return}if(c.current)return;c.current=!0;const n=u;s(!n);try{if(n){const{error:e}=await f.from("social_connections").delete().match({follower_id:t,following_id:l});if(e)throw e}else{const{error:e}=await f.from("social_connections").insert({follower_id:t,following_id:l});if(e)throw e}}catch(e){console.error("Error toggling follow:",e),s(n),alert("Could not update connection. Please try again.")}finally{c.current=!1}};return h||m?null:u?i.jsx("button",{onClick:w,className:"text-[10px] text-gray-400 hover:text-red-400 font-medium ml-2 transition-colors cursor-pointer",title:"Remove Connection",children:"Connected"}):i.jsxs("button",{onClick:w,className:"text-[10px] text-blue-500 hover:text-blue-600 font-bold ml-2 transition-colors flex items-center gap-0.5",title:"Connect with this user",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),"Connect"]})}export{y as default};
