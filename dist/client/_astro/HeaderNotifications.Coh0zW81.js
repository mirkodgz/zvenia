import{j as e}from"./jsx-runtime.BBGWwODT.js";import{r as c}from"./index.DYwCuWnG.js";import{s as p}from"./supabase.D-JsBXyn.js";import{a as h}from"./index.BWsCvz9k.js";import{D as j,a as w,b as I,c as v,d as M,e as k}from"./dropdown-menu.B2cUXs5G.js";import{c as o}from"./createLucideIcon.t37AtwoZ.js";import"./tslib.es6.eMSY344_.js";import"./index.Cs85si0U.js";import"./clsx.B-dksMZM.js";import"./index.DSCYIl9i.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=o("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=o("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=o("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=o("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=o("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function G({currentUserId:i,sessionAccessToken:n}){const[d,f]=c.useState([]),[l,y]=c.useState(0),[g,b]=c.useState(!0);c.useEffect(()=>{i&&x()},[i]);const x=async()=>{try{if(console.log("ðŸ”” [HeaderNotifications] Checking props user:",i),!i)return;let t=p;n&&(t=h("https://ddgdtdhgaqeqnoigmfrh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZ2R0ZGhnYXFlcW5vaWdtZnJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwNDE3NjMsImV4cCI6MjA4MjYxNzc2M30.aSW3Ds1z-8ta1sx-22P3NGyx4jzaY0aGNPPB9PsFcs0",{global:{headers:{Authorization:`Bearer ${n}`}}}));const{data:s,error:a}=await t.from("notifications").select("*").eq("user_id",i).order("created_at",{ascending:!1}).limit(10);if(a){console.error("ðŸ”” [HeaderNotifications] Error fetching:",a);return}console.log("ðŸ”” [HeaderNotifications] Data received:",s?.length,"rows"),s&&(f(s),y(s.filter(r=>!r.is_read).length))}catch(t){console.error("ðŸ”” [HeaderNotifications] Unexpected error:",t)}finally{b(!1)}},m=async t=>{if(!i)return;let s=p;n&&(s=h("https://ddgdtdhgaqeqnoigmfrh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRkZ2R0ZGhnYXFlcW5vaWdtZnJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwNDE3NjMsImV4cCI6MjA4MjYxNzc2M30.aSW3Ds1z-8ta1sx-22P3NGyx4jzaY0aGNPPB9PsFcs0",{global:{headers:{Authorization:`Bearer ${n}`}}}));let a=s.from("notifications").update({is_read:!0}).eq("user_id",i);t?a=a.eq("id",t):a=a.eq("is_read",!1),await a,x()};return e.jsxs(j,{children:[e.jsx(w,{asChild:!0,children:e.jsxs("button",{className:"relative text-gray-300 hover:text-white transition-colors focus:outline-none mr-2",children:[e.jsx(u,{className:"w-6 h-6"}),l>0&&e.jsx("span",{className:"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ring-2 ring-primary-500",children:l>9?"9+":l})]})}),e.jsxs(I,{align:"end",className:"w-80 bg-white border border-gray-200 shadow-lg mt-2 max-h-[80vh] overflow-y-auto",children:[e.jsxs(v,{className:"font-semibold text-gray-900 border-b border-gray-100 pb-2 flex justify-between items-center",children:[e.jsx("span",{children:"Notifications"}),l>0&&e.jsx("button",{onClick:t=>{t.preventDefault(),m()},className:"text-xs font-normal text-green-600 hover:text-green-700 cursor-pointer",children:"Mark all read"})]}),e.jsx("div",{className:"py-1",children:g?e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"Loading..."}):d.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No notifications"}):d.map((t,s)=>{let a=u,r="text-gray-400";switch(t.type){case"like":a=C,r="text-red-500";break;case"comment":a=J,r="text-blue-500";break;case"follow":case"connection_request":a=D,r="text-green-500";break;case"system":a=z,r="text-gray-500";break}return e.jsxs("div",{children:[e.jsx(M,{className:`cursor-pointer flex flex-col items-start gap-1 p-3 hover:bg-gray-50 ${t.is_read?"":"bg-green-50/50"}`,onClick:()=>m(t.id),children:e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("div",{className:`mt-1 ${r}`,children:e.jsx(a,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:`font-medium text-sm ${t.is_read?"text-gray-700":"text-gray-900"}`,children:t.title}),e.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap ml-2",children:new Date(t.created_at).toLocaleDateString()})]}),e.jsx("span",{className:"text-xs text-gray-500 line-clamp-2 mt-0.5",children:t.message})]})]})}),s<d.length-1&&e.jsx(k,{className:"bg-gray-100"})]},t.id)})})]})]})}export{G as default};
