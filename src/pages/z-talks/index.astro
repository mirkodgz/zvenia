---
import SocialLayout from "../../layouts/SocialLayout.astro";
import LeftSidebar from "../../components/social/LeftSidebar.astro";
import RightSidebar from "../../components/social/RightSidebar.astro";
import TalkCard from "../../components/talks/TalkCard";
import { createSupabaseServerClient } from "../../lib/supabase";
import type { Database } from "../../types/database.types";

const supabase = createSupabaseServerClient({
    req: Astro.request,
    cookies: Astro.cookies,
});

type Talk = Database["public"]["Tables"]["talks"]["Row"];

const { data: talks, error } = await supabase
    .from("talks")
    .select("*")
    .order("published_at", { ascending: false })
    .returns<Talk[]>();
---

<SocialLayout title="Z-TALKS | Zvenia Mining">
    <LeftSidebar slot="left-sidebar" />

    <div class="max-w-7xl mx-auto p-4 sm:p-6">
        {/* Header Section */}
        <div class="mb-8">
            <h1
                class="text-3xl sm:text-4xl font-extrabold text-(--text-main) mb-3 tracking-tight font-font-primary"
            >
                Z-TALKS
            </h1>
            <p
                class="text-lg text-(--text-secondary) max-w-2xl font-font-secondary"
            >
                Conversaciones exclusivas con líderes, innovadores y expertos
                que están transformando la industria.
            </p>
        </div>

        {/* Grid Layout */}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {
                error ? (
                    <div class="col-span-full p-6 border border-red-500/20 bg-red-500/10 rounded-lg text-red-400">
                        <p class="font-bold">Error loading talks</p>
                        <p class="text-sm">{error.message}</p>
                    </div>
                ) : talks && talks.length > 0 ? (
                    talks.map((talk) => (
                        <TalkCard
                            talk={{ ...talk, metadata: talk.metadata as any }}
                        />
                    ))
                ) : (
                    <div class="col-span-full py-12 text-center text-(--text-secondary) bg-(--bg-card) rounded-xl border border-(--border-color)">
                        <p>
                            No hay conversaciones disponibles en este momento.
                        </p>
                    </div>
                )
            }
        </div>
    </div>

    <RightSidebar slot="right-sidebar" />
</SocialLayout>
