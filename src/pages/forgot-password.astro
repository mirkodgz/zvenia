---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Reset Password - ZVENIA">
  <div class="min-h-screen bg-[var(--bg-body)] flex flex-col justify-center px-6">
    <div class="max-w-md mx-auto w-full">
      <div class="bg-[var(--bg-card)] p-8 rounded-xl border border-[var(--border-color)] shadow-2xl">
        <h1 class="text-2xl font-bold text-[var(--text-main)] mb-2">Reset Password</h1>
        <p class="text-sm text-[var(--text-secondary)] mb-6">
          Enter your email address and we'll send you a link to reset your password.
        </p>

        <form id="reset-form" class="space-y-4">
          <div>
            <label for="email" class="block text-sm font-medium text-[var(--text-main)] mb-2">
              Email address
            </label>
            <input
              id="email"
              name="email"
              type="email"
              autocomplete="email"
              required
              class="block w-full rounded-lg border-0 bg-[var(--bg-surface-hover)] py-3.5 px-4 text-[var(--text-main)] ring-1 ring-inset ring-[var(--border-color)] placeholder:text-[var(--text-secondary)] focus:ring-2 focus:ring-primary-500 text-lg transition-all"
              placeholder="your.email@example.com"
            />
          </div>

          <button
            type="submit"
            class="w-full justify-center rounded-lg bg-[#00c44b] px-4 py-3.5 text-lg font-bold text-white hover:bg-[#00a03d] focus:outline-none focus:ring-2 focus:ring-[#00c44b] focus:ring-offset-2 transition-all shadow-lg transform active:scale-[0.98]"
          >
            Send Reset Link
          </button>

          <div id="message" class="hidden mt-4 p-4 rounded-lg text-sm"></div>

          <div class="text-center pt-4">
            <a href="/login" class="text-sm font-medium text-primary-500 hover:text-primary-400 hover:underline">
              Back to Login
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { supabase } from '../lib/supabase';

  const form = document.getElementById('reset-form') as HTMLFormElement;
  const messageDiv = document.getElementById('message') as HTMLDivElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = (form.querySelector('#email') as HTMLInputElement).value;

    messageDiv.classList.add('hidden');
    messageDiv.classList.remove('bg-green-50', 'text-green-800', 'border-green-200', 'bg-red-50', 'text-red-800', 'border-red-200');

    try {
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${window.location.origin}/reset-password`,
      });

      if (error) {
        throw error;
      }

      messageDiv.textContent = 'Password reset email sent! Please check your inbox (and spam folder).';
      messageDiv.classList.add('bg-green-50', 'text-green-800', 'border', 'border-green-200');
      messageDiv.classList.remove('hidden');
      form.reset();
    } catch (error: any) {
      messageDiv.textContent = error.message || 'Failed to send reset email. Please try again.';
      messageDiv.classList.add('bg-red-50', 'text-red-800', 'border', 'border-red-200');
      messageDiv.classList.remove('hidden');
    }
  });
</script>

