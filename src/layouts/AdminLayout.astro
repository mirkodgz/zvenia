---
import "../styles/global.css";
import Header from "../components/Header.astro";

interface Props {
  title: string;
  activePage?: string;
}

const { title, activePage } = Astro.props;
const profile = (Astro.locals as any).profile;

// Verificar que profile existe, si no redirigir
if (!profile) {
    return Astro.redirect('/login');
}

const getLinkClass = (page: string) => {
    const baseClass = "flex items-center gap-3 px-4 py-3 rounded-lg transition-colors";
    const inactiveClass = "text-gray-700 hover:bg-gray-100";
    const activeClass = "bg-primary-50 text-primary-700 font-medium";
    
    return `${baseClass} ${activePage === page ? activeClass : inactiveClass}`;
};
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>{title} - Admin ZVENIA</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-50">
    <!-- Layout: Header + Sidebar + Main -->
    <div class="min-h-screen">
      <!-- Header Principal (mismo que el resto del sitio) -->
      <Header />

      <!-- Sidebar -->
      <aside class="fixed top-[70px] left-0 bottom-0 w-64 bg-white border-r border-gray-200 overflow-y-auto">
        <nav class="p-4 space-y-1">
          <!-- Dashboard -->
          <a
            href="/admin"
            class={getLinkClass('dashboard')}
          >
            <span class="material-icons text-[20px]">dashboard</span>
            <span class="font-medium">Dashboard</span>
          </a>

          <!-- Posts -->
          <a
            href="/admin/posts"
            class={getLinkClass('posts')}
          >
            <span class="material-icons text-[20px]">article</span>
            <span class="font-medium">Posts</span>
          </a>

          <!-- Events -->
          <a
            href="/admin/events"
            class={getLinkClass('events')}
          >
            <span class="material-icons text-[20px]">event</span>
            <span class="font-medium">Events</span>
          </a>

          <!-- Podcasts -->
          <a
            href="/admin/podcasts"
            class={getLinkClass('podcasts')}
          >
            <span class="material-icons text-[20px]">podcasts</span>
            <span class="font-medium">Podcasts</span>
          </a>

          <!-- Services -->
          <a
            href="/admin/services"
            class={getLinkClass('services')}
          >
            <span class="material-icons text-[20px]">business_center</span>
            <span class="font-medium">Services</span>
          </a>

          <hr class="my-4 border-gray-200" />

          <!-- Topics -->
          <a
            href="/admin/topics"
            class={getLinkClass('topics')}
          >
            <span class="material-icons text-[20px]">category</span>
            <span class="font-medium">Topics</span>
          </a>

          <!-- Media -->
          <a
            href="/admin/media"
            class={getLinkClass('media')}
          >
            <span class="material-icons text-[20px]">perm_media</span>
            <span class="font-medium">Media</span>
          </a>

          {profile?.role === 'Administrator' && (
            <>
              <hr class="my-4 border-gray-200" />

              <!-- Users (solo Administrator) -->
              <a
                href="/admin/users"
                class={getLinkClass('users')}
              >
                <span class="material-icons text-[20px]">people</span>
                <span class="font-medium">Users</span>
              </a>

              <!-- Settings (solo Administrator) -->
              <a
                href="/admin/settings"
                class={getLinkClass('settings')}
              >
                <span class="material-icons text-[20px]">settings</span>
                <span class="font-medium">Settings</span>
              </a>
            </>
          )}
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="ml-64 mt-[70px] p-8">
        <slot />
      </main>
    </div>
  </body>
</html>
